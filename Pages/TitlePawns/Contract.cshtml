@page
@model MyTitlePawnCompany.Pages.TitlePawns.ContractModel

@{
    ViewData["Title"] = "Title Pawn Contract";
    Layout = null;
}

@if (Model?.TitlePawn == null || Model?.Customer == null || Model?.Vehicle == null)
{
    <!DOCTYPE html>
    <html>
    <head>
        <title>Error - Contract</title>
        <style>
            body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
            .error-box { background: #fee; border: 1px solid #fcc; border-radius: 8px; padding: 20px; max-width: 600px; margin: 0 auto; }
            .error-title { color: #c33; font-size: 18px; font-weight: bold; margin-bottom: 10px; }
            .error-message { color: #666; margin-bottom: 10px; }
            a { color: #1a1a1a; text-decoration: none; font-weight: bold; }
        </style>
    </head>
    <body>
        <div class="error-box">
            <div class="error-title">?? Error Loading Contract</div>
            <div class="error-message">
                The contract could not be loaded. Please ensure:
            </div>
            <ul>
                <li>The loan exists and is approved</li>
                <li>A vehicle is associated with the loan</li>
                <li>A customer is associated with the vehicle</li>
                <li>You have permission to view this loan</li>
            </ul>
            <p><a href="javascript:history.back()">? Go Back</a></p>
        </div>
    </body>
    </html>
}
else
{
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Title Pawn Contract</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Times New Roman', Times, serif;
                color: #000;
                background: white;
                line-height: 1.5;
            }

            .container {
                max-width: 8.5in;
                height: auto;
                margin: 0 auto;
                padding: 0.5in;
                background: white;
                position: relative;
            }

            .header {
                text-align: center;
                margin-bottom: 20px;
                border-bottom: 2px solid #000;
                padding-bottom: 10px;
            }

            .company-name {
                font-size: 24px;
                font-weight: bold;
                margin-bottom: 5px;
            }

            .contract-title {
                font-size: 18px;
                font-weight: bold;
                text-decoration: underline;
                margin: 20px 0;
            }

            .section {
                margin-bottom: 15px;
                page-break-inside: avoid;
            }

            .section-title {
                font-weight: bold;
                text-decoration: underline;
                margin-bottom: 8px;
                font-size: 12px;
            }

            .parties {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin-bottom: 15px;
            }

            .party {
                border: 1px solid #000;
                padding: 10px;
            }

            .party-label {
                font-weight: bold;
                font-size: 12px;
                margin-bottom: 5px;
            }

            .party-detail {
                font-size: 11px;
                margin-bottom: 3px;
                line-height: 1.3;
            }

            .details-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                margin-bottom: 15px;
            }

            .detail-box {
                border: 1px solid #000;
                padding: 8px;
            }

            .detail-label {
                font-weight: bold;
                font-size: 11px;
            }

            .detail-value {
                font-size: 12px;
                margin-top: 3px;
            }

            .vehicle-details {
                border: 1px solid #000;
                padding: 10px;
                margin-bottom: 15px;
            }

            .vehicle-details-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                font-size: 11px;
            }

            .vehicle-detail-item {
                display: flex;
                justify-content: space-between;
                margin-bottom: 4px;
            }

            .vehicle-detail-label {
                font-weight: bold;
            }

            .terms-section {
                border: 1px solid #000;
                padding: 10px;
                margin-bottom: 15px;
                font-size: 11px;
                line-height: 1.6;
            }

            .term-item {
                margin-bottom: 8px;
            }

            .promise-section {
                border: 2px solid #000;
                padding: 12px;
                margin-bottom: 15px;
                background: #f9f9f9;
            }

            .promise-title {
                font-weight: bold;
                text-align: center;
                margin-bottom: 10px;
                font-size: 12px;
            }

            .promise-text {
                font-size: 11px;
                line-height: 1.6;
                margin-bottom: 10px;
                font-style: italic;
            }

            .warning-box {
                border: 3px solid #000;
                padding: 12px;
                margin-bottom: 15px;
                background: #ffff99;
                font-weight: bold;
                font-size: 12px;
                line-height: 1.6;
                text-align: center;
            }

            .disclosure-box {
                border: 1px solid #000;
                padding: 10px;
                margin-bottom: 15px;
                background: #f0f0f0;
                font-size: 10px;
                line-height: 1.5;
            }

            .disclosure-title {
                font-weight: bold;
                margin-bottom: 8px;
                text-decoration: underline;
            }

            .disclosure-item {
                margin-bottom: 6px;
                margin-left: 15px;
            }

            .signature-section {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin-top: 20px;
                font-size: 11px;
            }

            .signature-box {
                border-top: 1px solid #000;
                padding-top: 5px;
                text-align: center;
                min-height: 60px;
                display: flex;
                flex-direction: column;
                justify-content: flex-end;
            }

            .signature-label {
                font-weight: bold;
                font-size: 10px;
            }

            .date-line {
                margin-top: 20px;
                border-top: 1px solid #000;
                width: 200px;
                text-align: center;
            }

            .date-label {
                font-size: 10px;
                font-weight: bold;
            }

            .footer {
                text-align: center;
                font-size: 9px;
                margin-top: 20px;
                padding-top: 10px;
                border-top: 1px solid #ccc;
                color: #666;
            }

            .print-button {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 10px 20px;
                background: #1a1a1a;
                color: white;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                font-weight: bold;
                z-index: 1000;
            }

            .print-button:hover {
                background: #333;
            }
        </style>
    </head>
    <body>
        <button class="print-button" onclick="window.print()">Print Contract</button>

        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="company-name">@(Model?.Company?.Name ?? "Title Pawn Company")</div>
                <div>@(Model?.Company?.Address ?? "")</div>
                <div>@(Model?.Company?.Phone ?? "") | @(Model?.Company?.Email ?? "")</div>
            </div>

            <!-- Contract Title -->
            <div class="contract-title">GEORGIA TITLE PAWN AGREEMENT - 30 DAY TERM</div>

            <!-- GEORGIA REQUIRED WARNING - PROMINENT -->
            <div class="warning-box">
                ?? FAILURE TO MAKE YOUR PAYMENT AS DESCRIBED IN THIS DOCUMENT CAN RESULT IN THE LOSS OF YOUR MOTOR VEHICLE ??
            </div>

            <!-- Parties Section -->
            <div class="parties">
                <div class="party">
                    <div class="party-label">PAWN COMPANY:</div>
                    <div class="party-detail">
                        <strong>@(Model?.Company?.Name ?? "Title Pawn Company")</strong><br />
                        @(Model?.Company?.Address ?? "")<br />
                        Phone: @(Model?.Company?.Phone ?? "")<br />
                        Email: @(Model?.Company?.Email ?? "")
                    </div>
                </div>
                <div class="party">
                    <div class="party-label">PAWN HOLDER (BORROWER):</div>
                    <div class="party-detail">
                        <strong>@(Model?.Customer?.FirstName ?? "") @(Model?.Customer?.LastName ?? "")</strong><br />
                        Address: @(Model?.Customer?.Address ?? "")<br />
                        Phone: @(Model?.Customer?.PhoneNumber ?? "")<br />
                        Email: @(Model?.Customer?.Email ?? "")
                    </div>
                </div>
            </div>

            <!-- Vehicle Details -->
            <div class="section">
                <div class="section-title">VEHICLE DETAILS & COLLATERAL DESCRIPTION</div>
                <div class="vehicle-details">
                    <div class="vehicle-details-grid">
                        <div class="vehicle-detail-item">
                            <span class="vehicle-detail-label">Year:</span>
                            <span>@((Model?.Vehicle?.Year ?? 0).ToString())</span>
                        </div>
                        <div class="vehicle-detail-item">
                            <span class="vehicle-detail-label">Make:</span>
                            <span>@(Model?.Vehicle?.Make ?? "")</span>
                        </div>
                        <div class="vehicle-detail-item">
                            <span class="vehicle-detail-label">Model:</span>
                            <span>@(Model?.Vehicle?.Model ?? "")</span>
                        </div>
                        <div class="vehicle-detail-item">
                            <span class="vehicle-detail-label">Color:</span>
                            <span>@(Model?.Vehicle?.Color ?? "")</span>
                        </div>
                        <div class="vehicle-detail-item">
                            <span class="vehicle-detail-label">VIN:</span>
                            <span>@(Model?.Vehicle?.VIN ?? "")</span>
                        </div>
                        <div class="vehicle-detail-item">
                            <span class="vehicle-detail-label">License Plate:</span>
                            <span>@(Model?.Vehicle?.LicensePlate ?? "")</span>
                        </div>
                        <div class="vehicle-detail-item">
                            <span class="vehicle-detail-label">Mileage:</span>
                            <span>@(Model?.Vehicle?.Mileage?.ToString("N0") ?? "N/A") miles</span>
                        </div>
                        <div class="vehicle-detail-item">
                            <span class="vehicle-detail-label">Condition:</span>
                            <span>@(Model?.Vehicle?.Condition ?? "")</span>
                        </div>
                        <div class="vehicle-detail-item">
                            <span class="vehicle-detail-label">Estimated Value:</span>
                            <span>$@(Model?.Vehicle?.EstimatedValue.ToString("N2") ?? "0.00")</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loan Terms - ITEMIZED DISCLOSURES -->
            <div class="section">
                <div class="section-title">LOAN TERMS & ITEMIZED COST BREAKDOWN</div>
                <div class="details-grid">
                    <div class="detail-box">
                        <div class="detail-label">Principal Loan Amount:</div>
                        <div class="detail-value">$@(Model?.TitlePawn?.LoanAmountApproved.ToString("N2") ?? "0.00")</div>
                    </div>
                    <div class="detail-box">
                        <div class="detail-label">Monthly Interest Rate:</div>
                        <div class="detail-value">@((Model?.TitlePawn?.InterestRate ?? 0).ToString("N2"))% per month</div>
                    </div>
                    <div class="detail-box">
                        <div class="detail-label">Monthly Interest Charge:</div>
                        <div class="detail-value">$@(Model?.TitlePawn?.TotalInterestCharged.ToString("N2") ?? "0.00")</div>
                    </div>
                    <div class="detail-box">
                        <div class="detail-label">First Payment Due:</div>
                        <div class="detail-value">$@(Model?.TitlePawn?.MonthlyPayment.ToString("N2") ?? "0.00")</div>
                    </div>
                </div>

                <div class="disclosure-box">
                    <div class="disclosure-title">GEORGIA-REQUIRED ITEMIZED FEE & CHARGE DISCLOSURE:</div>
                    <div class="disclosure-item">• Principal Amount: $@(Model?.TitlePawn?.LoanAmountApproved.ToString("N2") ?? "0.00")</div>
                    <div class="disclosure-item">• Monthly Interest Rate: @((Model?.TitlePawn?.InterestRate ?? 0).ToString("N2"))% (as permitted under Georgia law)</div>
                    <div class="disclosure-item">• Monthly Interest Charge: $@(Model?.TitlePawn?.TotalInterestCharged.ToString("N2") ?? "0.00")</div>
                    <div class="disclosure-item">• Total Amount Due (at maturity): $@(((Model?.TitlePawn?.LoanAmountApproved ?? 0) + (Model?.TitlePawn?.TotalInterestCharged ?? 0)).ToString("N2"))</div>
                    <div class="disclosure-item">• All other fees: None at this time (unless modified by written amendment)</div>
                </div>
            </div>

            <!-- Terms and Conditions -->
            <div class="section">
                <div class="section-title">PAWN PERIOD, TERMS & CONDITIONS</div>
                <div class="terms-section">
                    <div class="term-item">
                        <strong>Pawn Period:</strong> This is a 30-day Title Pawn Agreement beginning on @(Model?.TitlePawn?.LoanStartDate.ToString("MMMM dd, yyyy") ?? "TBD") and maturing on @(Model?.TitlePawn?.LoanMaturityDate.ToString("MMMM dd, yyyy") ?? "TBD"). The borrower agrees to pay the full loan amount plus accrued interest on or before the maturity date.
                    </div>
                    <div class="term-item">
                        <strong>Extensions:</strong> If the borrower is unable to pay the full loan amount at maturity, the borrower may extend the pawn by paying the accrued interest charges. Extensions must be requested before the maturity date. Each extension renews the pawn for an additional 30-day period.
                    </div>
                    <div class="term-item">
                        <strong>Minimum Payment (Interest Only):</strong> The minimum payment due on @(Model?.TitlePawn?.LoanMaturityDate.ToString("MMMM dd, yyyy") ?? "TBD") is $@(Model?.TitlePawn?.MonthlyPayment.ToString("N2") ?? "0.00"). This payment covers the monthly interest and renews the pawn for an additional 30 days with the same principal balance of $@(Model?.TitlePawn?.LoanAmountApproved.ToString("N2") ?? "0.00").
                    </div>
                    <div class="term-item">
                        <strong>Early Payoff:</strong> The borrower may pay off the entire loan at any time without penalty or prepayment fee. Any additional payments beyond the minimum will reduce the principal balance.
                    </div>
                    <div class="term-item">
                        <strong>Vehicle Title as Collateral:</strong> The vehicle title will be held as collateral by @(Model?.Company?.Name ?? "Title Pawn Company") and returned upon full payment of the loan. The borrower retains ownership and use of the vehicle during the pawn period.
                    </div>
                    <div class="term-item">
                        <strong>Right to Redemption:</strong> The borrower has the right to redeem their vehicle at any time during the pawn period by paying the outstanding balance in full. Upon full payment, the vehicle title will be immediately released.
                    </div>
                    <div class="term-item">
                        <strong>Late Fees:</strong> Payments not received by the due date will be subject to late fees as permitted under Georgia law. Late fees will not exceed the limits set forth in O.C.G.A. § 34-6A-2.
                    </div>
                </div>
            </div>

            <!-- Repossession and Non-Recourse Notice -->
            <div class="section">
                <div class="section-title">REPOSSESSION, SALE, AND NON-RECOURSE PROVISION</div>
                <div class="terms-section">
                    <div class="term-item">
                        <strong>Repossession:</strong> If the borrower fails to make payment by the maturity date and does not request or complete an extension, @(Model?.Company?.Name ?? "Title Pawn Company") may repossess the vehicle. Repossession may occur without court order or prior notice as permitted by Georgia law.
                    </div>
                    <div class="term-item">
                        <strong>Repossession Fees:</strong> Any repossession and related costs (towing, storage, etc.) shall be the responsibility of the borrower and limited by Georgia law. These fees will be disclosed separately if repossession occurs.
                    </div>
                    <div class="term-item">
                        <strong>Vehicle Sale:</strong> Following repossession, @(Model?.Company?.Name ?? "Title Pawn Company") may sell the vehicle through public or private sale. The borrower will be notified of the sale in accordance with Georgia law.
                    </div>
                    <div class="term-item">
                        <strong>?? NON-RECOURSE PROVISION (GEORGIA LAW):</strong> <strong>This transaction is non-recourse.</strong> The borrower is NOT liable for any deficiency if the proceeds from the sale of the vehicle do not cover the outstanding loan balance. The vehicle sale proceeds are the sole remedy for default.
                    </div>
                </div>
            </div>

            <!-- Promise to Pay Section -->
            <div class="section">
                <div class="promise-section">
                    <div class="promise-title">BORROWER'S PROMISE TO PAY</div>
                    <div class="promise-text">
                        I, @(Model?.Customer?.FirstName ?? "") @(Model?.Customer?.LastName ?? ""), hereby promise and agree to pay to @(Model?.Company?.Name ?? "Title Pawn Company") the sum of $@(Model?.TitlePawn?.LoanAmountApproved.ToString("N2") ?? "0.00") plus monthly interest of @(Model?.TitlePawn?.InterestRate ?? 0)% according to the terms outlined in this agreement. I understand that my vehicle title will be held as collateral until this loan is paid in full. I acknowledge that I have received and read a copy of this agreement and understand all terms and conditions, including all costs, fees, and charges disclosed herein.
                    </div>
                    <div class="promise-text">
                        I agree to maintain the vehicle in good condition and keep it insured. I understand that failure to make payments by the maturity date or to request an extension may result in repossession of my vehicle. I further understand that I have the right to redeem (pay off) my vehicle at any time during the pawn period and am not liable for any deficiency in the sale of the vehicle if repossession occurs.
                    </div>
                </div>
            </div>

            <!-- Signature Section -->
            <div class="signature-section">
                <div>
                    <div class="signature-box">
                        <div class="signature-label">Borrower Signature</div>
                    </div>
                    <div class="date-line">
                        <div class="date-label">Date</div>
                    </div>
                </div>
                <div>
                    <div class="signature-box">
                        <div class="signature-label">@(Model?.Company?.Name ?? "Title Pawn Company") Representative</div>
                    </div>
                    <div class="date-line">
                        <div class="date-label">Date</div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                <p><strong>This is a legally binding document. Please keep a copy for your records.</strong></p>
                <p>This agreement complies with Georgia Title Pawn Law (O.C.G.A. § 34-6A et seq.)</p>
                <p>Contract ID: @(Model?.TitlePawn?.Id.ToString() ?? "N/A") | Generated: @DateTime.UtcNow.ToString("MMMM dd, yyyy")</p>
            </div>
        </div>
    </body>
    </html>
}
